---
import { BannerUpdate } from '@components/banner-update/banner-update.tsx';
import { CardListOnderzoek } from '@components/card-list-onderzoek/card-list-onderzoek.tsx';
import { CardListTheme } from '@components/card-list-theme/card-list-theme.tsx';
import { Hero } from '@components/hero/hero.tsx';
import { PageSection } from '@components/page-section/page-section.tsx';
import Layout from '@layouts/default.astro';
import { Heading } from '@nl-design-system-candidate/heading-react';
import { getOnderzoekenByTheme } from '@utils/themes';
import { getCollection } from 'astro:content';

const themes = await getCollection('themes');
const themesWithItems = await Promise.all(
  themes.map(async (theme) => ({
    ...theme,
    items: await getOnderzoekenByTheme(theme.id),
  })),
);
const sortedThemes = themesWithItems
  .filter((theme) => theme.items.length > 0)
  .toSorted(
    (a, b) =>
      // sort by amount of onderzoeken and the order property
      b.data.order - a.data.order || b.items.length - a.items.length,
  );

const onderzoeken = await getCollection('onderzoeken');
const recentOnderzoeken = onderzoeken.toSorted((a, b) => b.data.date_added - a.data.date_added);
const recentOnderzoekenTop3 = recentOnderzoeken.toSpliced(3, Infinity);
---

<Layout canonical={Astro.url} description="Gedeelde gebruikersonderzoeken voor de overheid">
  <Hero />

  <PageSection withSpace>
    <Heading level={2}>Thema's</Heading>
    <CardListTheme headingLevels={3} columns={2} themes={sortedThemes} />
  </PageSection>

  <BannerUpdate
    heading="Geef feedback op CIDO"
    content="De Code Inclusief Digitaal Ontwerpen (CIDO) geeft praktische richtlijnen om digitale diensten toegankelijk en inclusief te maken. We vragen de community om CIDO te gebruiken bij gebruikersonderzoeken en feedback te delen, zodat we samen de code kunnen verbeteren en versterken."
    footerActions={[
      { href: 'https://github.com/nl-design-system/gebruikersonderzoeken/discussions/407', label: 'Geef feedback' },
      { href: 'https://www.accessibility.nl/code-inclusief-digitaal-ontwerpen', label: 'Meer over CIDO' },
    ]}
  />

  <PageSection withSpace>
    <Heading level={2}>Nieuwste onderzoeken</Heading>
    <div>
      <a href="/docs/onderzoek-bekijken/" class="nl-link">Bekijk alle onderzoeken</a>
    </div>
    <CardListOnderzoek headingLevels={3} onderzoeken={recentOnderzoekenTop3} />
  </PageSection>
</Layout>
