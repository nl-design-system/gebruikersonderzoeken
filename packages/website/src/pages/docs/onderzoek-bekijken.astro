---
import CenterColumnLayout from '@layouts/center-column.astro';
import { getOnderzoekenByTheme } from '@utils/themes';
import { getCollection } from 'astro:content';

const themes = await getCollection('themes')
  .then((themes) =>
    themes.map(async (theme) => ({
      ...theme,
      items: await getOnderzoekenByTheme(theme.id),
    })),
  )
  .then(async (promises) => await Promise.all(promises))
  .then((themes) => themes.toSorted((a, b) => (a.items.length > b.items.length ? 1 : -1)))
  .then((themes) => themes.toSorted((a, b) => (a.data.order < b.data.order ? 1 : -1)));
---

<CenterColumnLayout>
  <p>Onderzoeken bekijken</p>
  <ul>
    {
      themes.map((theme) => (
        <li>
          <a class="nl-link" href={`/docs/thema/${theme.id}`}>
            {theme.data.title} ({theme.items.length})
          </a>
        </li>
      ))
    }
  </ul>
</CenterColumnLayout>
