---
import { CardListTheme } from '@components/card-list-theme/card-list-theme.tsx';
import CenterColumnLayout from '@layouts/center-column.astro';
import { Heading } from '@nl-design-system-candidate/heading-react';
import { getOnderzoekenByTheme } from '@utils/themes';
import { getCollection } from 'astro:content';

const themes = await getCollection('themes');

const themesWithItems = await Promise.all(
  themes.map(async (theme) => ({
    ...theme,
    items: await getOnderzoekenByTheme(theme.id),
  })),
);

const sortedThemes = themesWithItems
  .filter((theme) => theme.items.length > 0)
  .toSorted(
    (a, b) =>
      // sort by amount of onderzoeken and the order property
      b.data.order - a.data.order || b.items.length - a.items.length,
  );
---

<CenterColumnLayout>
  <Heading level={1}>Onderzoeken bekijken</Heading>
  <CardListTheme themes={sortedThemes} />
</CenterColumnLayout>
