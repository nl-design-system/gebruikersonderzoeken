---
import type { GetStaticPaths } from 'astro';
import { CardListOnderzoek } from '@components/card-list-onderzoek/card-list-onderzoek';
import CenterColumnLayout from '@layouts/center-column.astro';
import { Heading } from '@nl-design-system-candidate/heading-react';
import { Paragraph } from '@nl-design-system-candidate/paragraph-react';
import { BodyCopy } from '@nl-design-system-community/ma-components/local/body-copy/body-copy';
import { getOnderzoekenByTheme } from '@utils/themes';
import { getCollection, render } from 'astro:content';

export const getStaticPaths = (async () => {
  const themes = await getCollection('themes');
  return themes.map((theme) => ({
    params: { theme: theme.id },
    props: { theme },
  }));
}) satisfies GetStaticPaths;

const { theme } = Astro.props;
const { Content } = await render(theme);
const onderzoeken = await getOnderzoekenByTheme(theme.id)
  .then((onderzoeken) =>
    onderzoeken.map(async (onderzoek) => {
      const { Content } = await render(onderzoek);
      return { ...onderzoek, description: Content };
    }),
  )
  .then((onderzoekenPromises) => Promise.all(onderzoekenPromises));
---

<CenterColumnLayout>
  <BodyCopy small>
    <div class="ma-theme-page__header">
      <Heading level={1}>{theme.data.title}</Heading>
      <Paragraph purpose="lead">{theme.data.description}</Paragraph>
      <Content />
      <Paragraph>
        {onderzoeken.length} onderzoeken
      </Paragraph>
    </div>
  </BodyCopy>

  <CardListOnderzoek onderzoeken={onderzoeken} />
</CenterColumnLayout>

<style>
  .ma-theme-page__header {
    display: flex;
    flex-direction: column;
    gap: 24px;
  }
</style>
